# 一. 介绍

​		Sharding-JDBC是Sharding-Sphere的第一个产品，也是Sharding-Sphere的前身。

​		它定位为轻量级Java框架，在Java的JDBC层提供分库分表、读写分离、数据库治理、柔性事务等服务。它使用客户端直连数据库，以jar包形式提供服务，无需额外部署和依赖，可理解为增强版的JDBC驱动，完全兼容JDBC和各种ORM框架。

## 1.1 主要功能

- 读写分离
- 

## 1.1 与MyCat区别

​		目前分库分表的中间件有两种思想，分别是：

1. 类似 Sharding-JDBC 及 TDDL 的增强版 JDBC 驱动思想
2. 类似 Mycat 增加中间层，然后在中间层进行分库分表思想

​		 从设计理念上看确实有一定的相似性。主要流程都是SQL 解析 -> SQL 路由 -> SQL 改写 -> SQL 执行 -> 结果归并。但架构设计上是不同的。Mycat 是基于 Proxy，它复写了 MySQL 协议，将 Mycat Server 伪装成一个 MySQL 数据库，而 Sharding-JDBC 是基于 JDBC 的扩展，是以 jar 包的形式提供轻量级服务的。

​		JDBC 驱动版的优点：

- 轻量，范围更加容易界定，只是 JDBC 增强，不包括 HA、事务以及数据库元数据管理
- 开发的工作量较小，无需关注 nio，各个数据库协议等
- 运维无需改动，无需关注中间件本身的 HA
- 性能高，JDBC 直连数据库，无需二次转发
- 可支持各种基于 JDBC 协议的数据库，如：MySQL，Oralce，SQLServer

​		Proxy 版的优点：

- 可以负责更多的内容，将数据迁移，分布式事务等纳入 Proxy 的范畴
- 更有效的管理数据库的连接
- 整合大数据思路，将 OLTP 和 OLAP 分离处理

​		因此两种方式互相可以互补，建议使用 Java 的团队，且仅 OLTP 的互联网前端操作。有可能会使用多种数据库的情况，可以选择 JDBC层的中间件；如果需要 OLAP 和 OLTP 混合，加以重量级的操作，如数据迁移，分布式事务等，可以考虑 Proxy 层的中间件。



# 三. 读写分离

## 3.1 概念

- 主库：添加、更新以及删除数据操作所使用的数据库，目前仅支持单主库。
- 从库：查询数据操作所使用的数据库，可支持多从库。
- 主从同步：将主库的数据异步的同步到从库的操作。由于主从同步的异步性，从库与主库的数据会短时间内不一致。
- 负载均衡策略：通过负载均衡策略将查询请求疏导至不同从库。

## 3.2 核心功能

1. 提供一主多从的读写分离配置，可独立使用，也可配合分库分表使用
2. 独立使用读写分离支持SQL透传
3. 同一线程且同一数据库连接内，如有写入操作，以后的读操作均从主库读取，用于保证数据一致性。
4. 基于Hint的强制主库路由。



# 四. 分库分表

## 4.1 概念

1. 分片键（Sharding Column）

   ​		用于分片的数据库字段，是将数据库（表）水平拆分的关键字段。例：将订单表中的订单主键的尾数取模分片，则订单主键为分片字段。 SQL中如果无分片字段，将执行全路由，性能较差。 除了对单分片字段的支持，ShardingSphere也支持根据多个字段进行分片。

2.  分片算法（Sharding Algorithm）

   进行水平拆分时采用的算法，分片算法需要应用方开发者自行实现，可实现的灵活度非常高。目前提供4种分片算法。由于分片算法和业务实现紧密相关，因此并未提供内置分片算法，而是通过分片策略将各种场景提炼出来，提供更高层级的抽象，并提供接口让应用开发者自行实现分片算法。

3. 分片策略（Sharding Strategy）

   包含分片键和分片算法，由于分片算法的独立性，将其独立抽离。真正可用于分片操作的是分片键 + 分片算法，也就是分片策略。目前提供5种分片策略。

4. 逻辑表（Logic Table）

   ，进行水平拆分的时候同一类型（逻辑、数据结构相同）的表的总称。例：订单数据根据主键尾数拆分为10张表，分别是`t_order_0`到`t_order_9`，他们的逻辑表名为`t_order`。

5. 真实表（Actual Table）

   在分片的数据库中真实存在的物理表。即上个示例中的`t_order_0`到`t_order_9`。

6. 绑定表（Binding Table）

   指分片规则一致的主表和子表

7. 数据节点（Data Node）

   数据分片的最小单元。由数据源名称和数据表组成，例：`ds_0.t_order_0`。

## 2. 垂直拆分

​		垂直拆分可分为垂直分库和垂直分表。垂直分库就是根据业务耦合性，将关联度低的不同表存储在不同的数据库。垂直分表是基于数据库中的"列"进行，某个表字段较多，可以新建一张扩展表，将不经常用或字段长度较大的字段拆分出去到扩展表中。

优点：

1. 解决业务系统层面的耦合，业务清晰
2. 对不同业务的数据进行分级管理、维护、监控、扩展等
3. 高并发场景下，垂直切分一定程度的提升IO、数据库连接数、单机硬件资源的瓶颈

缺点：

1. 部分表无法join，只能通过接口聚合方式解决，提升了开发的复杂度
2. 分布式事务处理复杂
3. 依然存在单表数据量过大的问题（需要水平切分）

## 3. 水平拆分

​		水平拆分可分为库内分表和分库分表。

优点：

1. 不存在单库数据量过大、高并发的性能瓶颈，提升系统稳定性和负载能力

缺点：

1. 数据多次扩展难度和维护量极大
2. 跨分片的事务一致性难以保证
3. 跨库的join关联查询性能较差



